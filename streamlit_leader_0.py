"""
파일명: /Users/airim/github/hari_fold_django/llm_hub/leader_llm/streamlit_leaderon_chat.py
기능: CJ LeaderON 리더십 면담 시나리오 챗봇 (1단계 자동 파싱 + 2단계 PDF 업로드 + 3단계 면담 목적 파악 + 4단계 시나리오 생성)
"""

import streamlit as st
import re
import os

st.set_page_config(page_title="CJ LeaderON (리더십 시나리오)", page_icon="💬", layout="centered")

# -------------------------------
# 1. 안내 시나리오 텍스트
# -------------------------------
intro_message = """
**CJ LeaderON (CJ 리더온)의 말:**

💡 **효과적인 1:1 면담 시나리오**

이 메뉴는 구성원의 강점을 활용한 1:1 코칭 면담을 위한 맞춤형 시나리오를 제공합니다.  
현장/본사 환경과 시간대별로 최적화된 가이드를 생성합니다.

---

### 🎯 생성 결과물
✅ 구성원 강점 인사이트 (레버리지·균형·승부처)  
✅ 면담 목표 및 아젠다  
✅ CJ 인재상 탐색 핵심 질문 5개  
✅ 강점 기반 긍정적 피드백 방법  
✅ 액션 플랜 및 후속 조치 가이드

---

### 🧭 진행 순서
1️⃣ 구성원 및 면담 환경 정보 입력 ← **현재 단계**  
2️⃣ 강점 데이터 분석 (PDF 업로드)  
3️⃣ 면담 목적 및 환경 파악  
4️⃣ 이슈 및 성장 포인트 분석  
5️⃣ 맞춤형 면담 시나리오 생성  
⏰ 소요시간: 입력 8분 + 생성 30초

---

📘 **입력 예시**
공사3팀 / 공사 PE / 5년차 / 45분 / 현장 사무소 / 성장 지원  
입력 후 “다음 단계”라고 말씀해 주세요.
"""

# -------------------------------
# 2. 세션 상태 초기화
# -------------------------------
if "chat_started" not in st.session_state:
    st.session_state.chat_started = False
if "chat_history" not in st.session_state:
    st.session_state.chat_history = []
if "step" not in st.session_state:
    st.session_state.step = 0  # 0=intro, 1=info입력, 2=pdf, 3=면담목적, 4=시나리오생성

# -------------------------------
# 3. 상단 UI
# -------------------------------
st.markdown("<h1 style='text-align:center; color:#2563eb;'>CJ LeaderON (CJ 리더온)</h1>", unsafe_allow_html=True)

# -------------------------------
# 4. 시작 버튼
# -------------------------------
if not st.session_state.chat_started:
    if st.button("💬 CJ LeaderON 시작하기", use_container_width=True):
        st.session_state.chat_started = True
        st.session_state.chat_history = [("assistant", intro_message)]
        st.session_state.step = 1
        st.rerun()

else:
    # -------------------------------
    # 5. 기존 대화 출력
    # -------------------------------
    for role, msg in st.session_state.chat_history:
        if role == "user":
            # 사용자 로고 (cj_company.png)
            with st.chat_message("user", avatar="/Users/airim/github/hari_fold_django/llm_hub/rpa_llm/assets/cj_company.png"):
                st.markdown(msg, unsafe_allow_html=True)
        else:
            # AI 답변 로고 (HARI_ICON.png)
            with st.chat_message("assistant", avatar="/Users/airim/github/hari_fold_django/llm_hub/rpa_llm/assets/HARI_ICON.png"):
                st.markdown(msg, unsafe_allow_html=True)


    # -------------------------------
    # 6. PDF 업로드 (2단계용)
    # -------------------------------
    if st.session_state.step == 2:
        uploaded_file = st.file_uploader("📎 강점 리포트 PDF를 업로드하세요.", type=["pdf"])
        if uploaded_file is not None:
            save_path = os.path.join("uploads", uploaded_file.name)
            os.makedirs("uploads", exist_ok=True)
            with open(save_path, "wb") as f:
                f.write(uploaded_file.getbuffer())

            pdf_name = uploaded_file.name
            response = f"""
CJ LeaderON (CJ 리더온)의 말:
✅ **2단계 완료: 강점 데이터 분석**

💡 **{pdf_name}의 태니지먼트 강점 Top6 요약**
(출처: {pdf_name})

| 구분 | 강점 | 설명 요약 | 연결 가능한 CJ 인재상 |
|------|------|------------|----------------------|
| 1 | 완성(Complete) | 맡은 일을 끝까지 완벽히 마무리하며 품질을 높이는 강점 | 책임감 · 업전문성 |
| 2 | 외교(Connect) | 네트워크를 형성하고 사람을 연결해 문제를 해결하는 강점 | 비전공감 · 실행의지 |
| 3 | 사교(Social) | 새로운 사람을 만나고 협력 관계를 만드는 데 강함 | 비전공감 |
| 4 | 유연(Flexible) | 변화에 빠르게 적응하고 다양한 방법으로 대응 | 실행의지 |
| 5 | 신중(Careful) | 위험요소를 미리 파악하고 안전하게 결정 | 책임감 |
| 6 | 효율(Productive) | 다양한 대안을 비교·분석해 최적의 선택을 하는 강점 | 업전문성 |

---

⚠️ **주의 태도 (개발 필요 영역)**  
• 용기(Courage): 변화를 주저하지 않고 행동으로 옮기는 태도  
• 자신감(Confidence): 자신의 능력에 대한 확신과 표현  

---

이제 다음 단계로 넘어갑니다.  
💬 **3단계: 면담 목적 및 환경 파악**  

다음 항목을 입력해 주세요 💬  
- 면담 세부 목적 (복수 선택 가능)  
  □ 강점 기반 피드백 및 인정  
  □ 일관리 루틴 점검  
  □ 성과관리 체계 강화  
  □ 성장 방향 탐색  
  □ 관계·협업 개선  
- 현재 주요 업무나 이슈 (예: 교육 과정 기획 일정 관리, 리더십 프로그램 운영, 보고 체계 개선 등)

---

📘 **입력 예시**  
💬 일관리 루틴 점검 + 성장 방향 탐색  
💬 주요 업무: 리더십 교육 프로그램 일정 관리 및 운영 효율화
"""
            st.session_state.chat_history.append(("assistant", response))
            st.session_state.step = 3
            st.rerun()

    # -------------------------------
    # 7. 사용자 입력 처리
    # -------------------------------
    user_input = st.chat_input("메시지를 입력하세요...")

    if user_input:
        st.session_state.chat_history.append(("user", user_input.strip()))
        response = None

        # 1단계
        if st.session_state.step == 1 and re.match(r".+/.+/.+/.+/.+/.+", user_input):
            parts = [p.strip() for p in user_input.split("/")]
            team, role, years, time, place, purpose = parts[:6]

            response = f"""
CJ LeaderON (CJ 리더온)의 말:
✅ **1단계 완료: 구성원 및 면담 환경 정보 확인**

**구성원 정보:**  
• 팀/부서: {team}  
• 직무/역할: {role}  
• 경력 연차: {years}  

⏰ **면담 환경:**  
• 면담 시간: {time}  
• 면담 장소: {place}  
• 면담 목적: {purpose}  

---

💡 **2단계: 강점 데이터 분석**  
PDF 리포트를 업로드해 주세요.  
(예: `정열창001-2025-09-29-strength-3239991.pdf`)

---

2단계: 강점 및 면담 목적 파악  
다음 중 한 가지 방법으로 강점 데이터를 제공해 주세요  
A) 태니지먼트 강점리포트 업로드 (추천)  
→ Top6 강점, 오버/언더유즈, 동기요소 자동 추출  

B) 간이 강점 진단 (5개 질문으로 주요 강점 추정)  

C) 직접 입력 (알고 계신 주요 강점 3~6개 텍스트 입력)  

예시: 성취지향 / 분석적 사고 / 배움추구 / 조화 / 책임감 / 실행력  
원하시는 방법을 선택해 주세요.  

(예: “✍️ 직접 입력” 또는 “간이 진단 시작”)
"""
            st.session_state.step = 2

        # 3단계
        elif st.session_state.step == 3 and "일관리를 통한" in user_input:
            response = """
CJ LeaderON (CJ 리더온)의 말:

✅ **3단계 완료: 면담 목적 및 환경 파악**

### 🎯 면담 핵심 목적
- 일관리를 통한 구체적 성장 방향 설정  
- 도전적·창의적 과제 탐색  
- 리더십 육성 로드맵 기획 역량 향상  

### 💼 현재 주요 업무
- 온보딩 프로그램 운영 (주니어 리더십 개발 중심)  
- 리더십 프로그램 운영 (보직자 리더십 역량 강화 중심)  
- 운영의 안정성과 체계성 확보 완료, 이제는  
  → 두 프로그램 간의 **연결성 강화** 및  
  → **전사 리더십 육성 로드맵 설계 역량 향상**이 핵심 성장 과제  

---

다음 단계로 넘어가겠습니다.  

### 🧭 4단계: 면담 시나리오 생성 전 맥락 세팅
면담 목표를 명확히 하기 위해 아래 내용을 알려주세요.  

1️⃣ 이번 면담의 초점 중 가장 중요한 것은 무엇인가요?  
(예: 업무 효율화 / 기획력 강화 / 성장 방향 설계 / 동기부여 / 역할 확장 등)  

2️⃣ 면담 후 구성원이 어떤 상태로 변화하길 바라시나요?  
(예: 스스로 성장 계획을 설계할 수 있는 상태 / 새로운 시도에 자신감 회복 / 프로그램 주도 역량 강화 등)  

---

💡 위 두 가지를 입력해 주시면,  
➡️ **45분 맞춤형 1:1 코칭 면담 시나리오 (질문 5개 + 피드백 구조 + 액션 플랜 포함)**을 생성하겠습니다.
"""
            st.session_state.step = 4

        # 4단계
        elif st.session_state.step == 4 and "이번 면담을 통해서" in user_input:
            response = """

정열창001님 1:1 코칭 면담 시나리오 (45분)  
면담 목적:  
일관리 효율화를 통해 여유 자원을 확보하고, 주니어~시니어 리더십 교육체계를 연결하는 리더십 육성 로드맵 기획 역량 강화 및 역할 확장 동기 부여  

---

### 1. 면담 개요
| 구분 | 내용 |
|------|------|
| 면담 시간 | 45분 |
| 면담 장소 | 회의실 |
| 면담 목적 | 일관리 효율화 → 리더십 육성 로드맵 기획 역량 강화 → 주도적 성장 방향 설정 |
| 코칭 포인트 | 강점(완성·외교·유연·신중)을 기반으로 효율화 및 주도성 강화 |

---

### 2. 면담 구조 및 시간 배분
| 구간 | 소요 시간 | 코칭 흐름 | 리더의 역할 |
|------|------------|------------|--------------|
| ① 관계 형성 & 현상 인식 | 10분 | 현재 업무 방식과 효율화 필요성 탐색 | 관찰·공감·인식 전환 유도 |
| ② 강점 인식 & 긍정 피드백 | 10분 | 강점이 잘 발휘된 구체 사례 피드백 | SBI/COIN 구조 활용 |
| ③ 성장 방향 탐색 | 15분 | ‘왜’ 리더십 체계 기획이 본인 성장과 연결되는지 내재적 동기 강화 | 질문 중심 코칭 |
| ④ 실행 계획 합의 | 10분 | 일관리 효율화 + 리더십 기획 도전 과제 도출 | SMART 기반 합의 |

---

### 3. 면담 핵심 질문 (CJ 인재상 연결형)
**1. 현상 인식 (비전공감)**  
“최근 운영 업무 중 ‘안 해도 될 일’이라고 느껴진 반복 업무나 보고 절차는 어떤 게 있었나요?”  
→ 실행의지  
“그 부분을 줄이게 된다면 어떤 일에 더 집중하고 싶나요?”  
→ 비전공감  

**2. 강점 활용 (업전문성)**  
“지금까지 프로그램 운영에서 ‘완성 강점’이 가장 빛났던 순간은 언제였나요?”  
→ 책임감  
“그 과정에서 정열창001님의 세심함이나 네트워크 역량이 어떤 영향을 주었나요?”  
→ 외교·책임감  

**3. 성장 방향 탐색 (실행의지)**  
“앞으로 주니어~시니어 리더십을 하나의 체계로 잇는 교육 로드맵을 만든다면, 어떤 흐름이나 구조가 이상적일까요?”  
→ 비전공감  
“그 기획이 완성된다면, 본인의 역할은 지금보다 어떻게 확장될까요?”  
→ 실행의지  

**4. 실행 합의 (책임감)**  
“다음 달까지 업무 효율화를 위해 시도해볼 수 있는 조정 과제 1가지와, 새 리더십 체계 구상을 위한 첫 행동은 무엇일까요?”  
→ 책임감·업전문성  

---

### 4. 강점 기반 긍정 피드백 문구 (SBI/COIN 예시)
**비전공감 (외교·사교)**  
SBI: “리더십 프로그램 회의에서 다양한 부서 의견을 연결해 조율해 준 점이 전사적 시각 확장에 큰 도움이 되었습니다.”  
COIN: “앞으로 온보딩-리더십 프로그램을 연결할 때, 본인의 네트워크 감각을 적극 발휘하신다면 더 큰 시너지가 있을 것입니다.”  

**실행의지 (유연·효율)**  
SBI: “예기치 않은 일정 변경 상황에서 차분하게 일정 재조정안을 제시한 점이 프로그램 안정 운영에 기여했습니다.”  

**책임감 (신중·완성)**  
COIN: “프로그램의 품질 점검에 세심하게 접근하신 모습은 높은 책임감의 표현입니다. 다만 전체 구조 설계 시에는 완벽보다 ‘적정 효율’을 기준으로 시도해보시면 좋겠습니다.”  

**업전문성 (효율)**  
SBI: “프로세스 개선 회의에서 중복 업무를 줄이는 방안을 제시한 점이 효율적 시스템 운영에 기여했습니다.”  

---

### 5. 실행 및 후속 조치 가이드
| 구분 | 실행 항목 | 완료 기준 | 점검 시점 |
|------|------------|------------|------------|
| 업무 효율화 | 반복·불필요 업무 최소 1건 제거 (예: 보고 단순화, 중복 일정 통합) | 주간 회의 시 개선안 공유 | 2주 내 |
| 리더십 체계 기획 착수 | 온보딩~리더십 연계 로드맵 초안 작성 | 흐름도 및 핵심 역량맵 제시 | 1개월 내 |
| 도전적 기획 주제 설정 | 차세대 리더 육성 신규 과제 1개 제안 | 안건 문서 제출 | 분기 말 |
| 자기 리더십 개발 | 자신감·용기 강화 행동 실험 (예: 회의 제안, 발표) | 주 1회 실천 사례 공유 | 지속 |

---

### 6. 면담 마무리 코멘트 예시
“지금까지의 운영 역량이 ‘안정과 품질’을 만들어냈다면, 앞으로는 ‘효율과 확장’으로 넘어가는 시점이에요.  
완성 강점이 주는 꼼꼼함과 신중함을 유지하면서도, 외교·유연 강점을 더 전면에 세워 리더십 체계의 설계자로 성장하시길 기대합니다.”

---

원하신다면 💬 /현장면담 형식으로 실제 대화 스크립트(리더 발화 + 구성원 예상 반응) 버전으로도 정리해드릴 수 있습니다.  
그렇게 해드릴까요?




"""
            st.session_state.step = 5



        # 5단계: 현장면담 요청
        elif st.session_state.step == 5 and "실제 대화할 수 있게" in user_input:
            st.session_state.step = 6
            response = """

CJ LeaderON (CJ 리더온)의 말:  
좋습니다.  
아래는 “신유소미님 1:1 코칭 면담 시나리오 (45분)”의 **실제 대화형 스크립트 버전**입니다.  
리더 발화 중심으로 구성되었으며, 각 주요 질문마다 **신유소미님 예상 반응 3가지 버전**  
(① 현상인식형 / ② 성장지향형 / ③ 내면탐색형)으로 분기 대응하도록 설계했습니다.  

면담 목적은 동일하게  
**일관리 효율화 → 리더십 로드맵 기획 역량 강화 → 역할 확장 동기 부여**입니다.  

---

## 🗂 1:1 코칭 면담 스크립트 (총 45분)

### 1단계. 오프닝 & 관계 형성 (약 5분)
리더:  
“유소미님, 오늘은 업무 피드백보다는 ‘일을 어떻게 관리하고, 그 안에서 성장 방향을 설계할 수 있을까’에 초점을 두고 이야기해보면 좋을 것 같아요.  
지금까지 프로그램 운영을 안정적으로 잘 해오셨는데, 앞으로는 조금 더 도전적인 방향을 함께 찾아보고 싶습니다.”  

(격려용 코멘트)  
“이 면담은 잘못된 점을 찾는 자리가 아니라, ‘잘하고 있는 일을 더 전략적으로 활용하는 방법’을 함께 설계하는 자리입니다.”

---

### 2단계. 현상 인식 및 효율화 탐색 (약 10분)
**목적:** 불필요한 업무 패턴 자각 및 효율화 포인트 도출  
**연결 인재상:** 실행의지 · 업전문성  

리더:  
“최근 업무 중 ‘이건 굳이 안 해도 될 것 같은데 계속 하고 있다’고 느꼈던 부분이 있을까요?”  

**예상 반응 ① 현상인식형**  
“보고나 내부 결재용 문서 중복이 좀 있는 것 같아요. 같은 데이터를 포맷만 바꿔서 세 번쯤 작성하는 경우도 있어요.”  
→ 리더 피드백:  
“좋아요. 그런 부분을 줄이면 에너지를 전략적 기획으로 전환할 여유가 생길 거예요.  
다음 달까지 한 가지 ‘없애볼 수 있는 루틴’을 정해보는 건 어떨까요?”

**예상 반응 ② 성장지향형**  
“운영은 익숙해서 루틴화됐는데, 새 프로그램 구상 쪽으로 시간을 더 쓰고 싶어요.”  
→ 리더 피드백:  
“아주 좋습니다. ‘운영 효율화 → 기획 여유 확보’라는 명확한 방향이네요.  
그 전환이 이번 면담의 핵심입니다.”

**예상 반응 ③ 내면탐색형**  
“없애야 하는 건 아는데, 막상 안 하면 불안해서 손을 떼기 어려워요.”  
→ 리더 피드백:  
“그건 완성 강점이 주는 책임감의 표현이에요. 완벽을 유지하려는 기준이 높기 때문이죠.  
이번에는 ‘100점 유지보다 90점으로 확장’이라는 기준으로 시도해보면 어떨까요?”

---

### 3단계. 강점 인식 및 긍정 피드백 (약 10분)
**목적:** 완성·외교·유연 강점의 가치 인식  
**연결 인재상:** 책임감 · 비전공감  

리더:  
“지금까지 운영 과정 중 ‘내가 이건 정말 잘했다’ 또는 ‘이건 내가 아니면 어려웠을 것 같다’는 순간이 있었나요?”  

**예상 반응 ① 현상인식형**  
“운영 매뉴얼 정비했을 때요. 세부 기준을 다듬으니까 이후 이슈가 확 줄었어요.”  
→ 리더 피드백 (SBI):  
“그때 세부 항목을 직접 정리해서 혼선이 사라졌던 점이 기억나요(상황).  
그건 완성 강점이 탁월하게 발휘된 사례예요(행동).  
결과적으로 운영 안정성이 크게 높아졌죠(영향).”

**예상 반응 ② 성장지향형**  
“부서 간 의견을 조율할 때 제가 중간다리 역할을 했던 게 인상 깊어요.”  
→ 리더 피드백 (COIN):  
“그게 바로 외교 강점이에요. 다양한 이해관계를 연결하는 역량은 리더십 체계 기획에도 꼭 필요한 자산이에요.  
다음엔 그 연결 감각을 ‘교육 로드맵 기획’에도 적용해보면 좋겠습니다.”

**예상 반응 ③ 내면탐색형**  
“운영 과정은 익숙한데, 새걸 만들 때는 자신감이 조금 부족한 것 같아요.”  
→ 리더 피드백:  
“그건 자연스러워요. 완성형 스타일의 분들은 검증된 영역에 강점을 보이니까요.  
지금은 ‘안정 → 도전’으로 성장 방향을 옮겨가는 시점이에요.”

---

### 4단계. 성장 방향 탐색 (약 15분)
**목적:** ‘왜 새로운 리더십 체계를 기획해야 하는가’ 내재적 동기 부여  
**연결 인재상:** 실행의지 · 비전공감  

리더:  
“주니어 리더십과 시니어 리더십 프로그램을 하나의 체계로 묶는다면, 어떤 모습이 가장 이상적이라고 생각하세요?”  

**예상 반응 ① 현상인식형**  
“지금은 각기 운영되는데, 단계별로 성장하는 흐름을 만들면 좋겠어요.  
예를 들어 피플매니저 → 팀리더 → 리더십 확장 같은 식으로요.”  
→ 리더 코멘트:  
“좋아요. 이미 구조적 사고가 잘 되어 있네요.  
그 그림을 기획안 형태로 옮기면 ‘리더십 로드맵 설계자’로서의 첫걸음이 될 거예요.”

**예상 반응 ② 성장지향형**  
“리더십 역량군을 통합해서 공통 언어로 정리해보면 어떨까 싶어요.”  
→ 리더 코멘트:  
“그 시도는 CJ 인재상 체계와도 연결됩니다.  
‘비전공감–실행의지–책임감–업전문성’이 리더십 단계별로 이어지도록 설계하면 좋겠어요.”

**예상 반응 ③ 내면탐색형**  
“새로운 구조를 만든다는 게 막막하게 느껴져요.”  
→ 리더 코멘트:  
“그건 ‘용기’ 태도와 연결된 성장 기회예요.  
‘완벽한 그림’보다 ‘첫 시도’에 의미를 두세요. 초안을 만드는 순간 이미 성장의 출발입니다.”

---

### 5단계. 실행 계획 합의 및 마무리 (약 5분)
**목적:** SMART 기반 실행 포인트 설정  
**연결 인재상:** 책임감 · 업전문성  

리더:  
“오늘 이야기한 걸 정리해보면, 우선은 ‘일 효율화로 시간 확보’와 ‘리더십 체계 기획 착수’ 이 두 가지 축이에요.  
이 중 이번 달 안에 실행해볼 수 있는 ‘작은 행동’ 한 가지를 정한다면 뭐가 좋을까요?”  

**예상 반응 예시:**  
① “중복 보고서 통합 정리부터 해볼게요.”  
② “리더십 로드맵 구조 초안을 슬라이드로 정리해볼게요.”  
③ “차기 리더십 기획 회의에서 새 제안 하나를 해볼게요.”  
→ 리더 피드백:  
“좋아요. 그게 바로 실행의지가 발현되는 지점이에요.  
결과보다 ‘시도’ 자체가 성장의 증거입니다.”

---

### 마무리 코멘트 (1분)
“유소미님은 이미 ‘완성·책임감’이라는 단단한 기반 위에 계세요.  
이제는 그 안정감을 ‘확장과 설계’로 옮기는 시점이에요.  
이번 달에는 작은 효율화와 하나의 시도만으로도 충분합니다.  
그 변화가 리더십 프로그램의 ‘다음 단계’를 여는 시작이 될 거예요.”

"""

        else:
            response = "입력 내용을 이해했습니다. 단계에 맞는 정보를 입력해주세요."

        st.session_state.chat_history.append(("assistant", response))
        st.rerun()
